!function($,window,document,History,undefined){function log(e){o.debug&&console.log(e)}var currentRequest=null,previousUrl="",previousSlug="",previousID=0,requestCount=0,wpAjax={},settings={content:"#content",cacheRequests:!0,cacheExpiry:1,waitForImages:!0,debug:!1},o=settings,$body=$("body"),$wpvars=$("wpvars"),$content=$(o.content);$(window).off("statechange").on("statechange",function(){var e=History.getState();log("Event.statechange: HTML5 History statechange event trigger with URL: "+e.url),previousUrl!==e.url?(log("Event.statechange: Calling the wpAjax.loadPage function with State.url as its parameter"),wpAjax.loadPage(e.url)):log("Event.statechange: User is already on the requested page to load. No request will be made.")}),wpAjax.configure=function(e){return log("configure: Setting options for Wpajax"),$.extend(settings,e),this},wpAjax.getConfiguration=function(){return settings},wpAjax.getCurrentUrl=function(){return log("getCurrentUrl: Getting the current browser address URL"),window.location.href},wpAjax.trigger=function(e){log("trigger: Calling History.pushState which will trigger a statechange"),previousUrl=wpAjax.getCurrentUrl(),previousSlug=wpvars.pagename,previousID=wpvars.pageid,wpAjax.getTitle(e,function(t){History.pushState({},t,e)})},wpAjax.pageLimitReached=function(){return wpvars.max==wpvars.paged},wpAjax.getCurrentPageNumber=function(){return wpvars.paged},wpAjax.getMaxPages=function(){return wpvars.max},wpAjax.loadPage=function(e){log("loadPage: No other request is taking place, we are good to go"),$("body").addClass("loading-page");var t=jQuery.Event("wpAjax.loading",{previousUrl:previousUrl,previousSlug:previousSlug,previousID:previousID,url:e});$(document).trigger(t),wpAjax.fadeOutContent(function(){wpAjax.doRequest(e,function(t){wpAjax.processRequest(t,e)},function(){wpAjax.fadeInContent(),log("loadPage: Called doRequest and the request failed. Throwing a failed event on document");var t=jQuery.Event("wpAjax.failed",{url:e});$(document).trigger(t)})}),log("loadPage: Loading class applied to body, loading event fired and content element faded out")},wpAjax.fadeOutContent=function(e){log("fadeOutContent: Animating content element out"),0===arguments.length&&(e=function(){}),$content.animate({opacity:0},800,e)},wpAjax.fadeInContent=function(e){log("fadeInContent: Animating content element in"),0===arguments.length&&(e=function(){}),$content.animate({opacity:1},800,e)},wpAjax.getTitle=function(e,t){var n="";log("getTitle: Calling wpAjax.doRequest now to get the title"),wpAjax.doRequest(e,function(e){n=$(e).filter("title").text(),log("getTitle: doRequest AJAX call successful. Title returned: "+n+" "),$.isFunction(t)&&t(n)},function(){$.isFunction(t)&&t(n)})},wpAjax.doRequest=function(e,t,n){log("doRequest: About to perform an AJAX call"),currentRequest=$.ajax({url:e,localCache:o.cacheRequests,cacheTTL:o.cacheExpiry,type:"GET",dataType:"html",requestCount:++requestCount,beforeSend:function(){null!==currentRequest&&currentRequest.abort()},success:function(e,n,o){log("doRequest: AJAX success callback"),requestCount===this.requestCount&&t(e,n,o)},error:function(e,t,o){log("doRequest: AJAX error callback"),$.isFunction(n)&&n(e,t,o)}})},wpAjax.processRequest=function(data,url){var _html=$(data),_content=_html.find(o.content).html(),_wpvars=_html.find("#wpvars").html(),_jsonobj=eval(_wpvars);if(console.log(_jsonobj),log("processRequest: Processing the data returned by a successful AJAX call"),_content&&_content.length){$("#wpvars").remove();var s=document.createElement("script");s.id="wpvars",s.type="text/javascript",s.text=_wpvars,$body.append(s);var completeEvent=jQuery.Event("wpAjax.complete",{previousUrl:previousUrl,previousSlug:previousSlug,previousID:previousID,content:data,url:url,slug:wpvars.pagename,ID:wpvars.pageid}),pageLoadEvent=jQuery.Event("wpAjax.page.load-"+wpvars.pagename);log("processRequest: Content found from the AJAX request, determining what to do with it"),o.waitForImages?(log("processRequest Wait for images option is enabled, finding images"),$(_content).find("img").length?(log("processRequest: We found images. Waiting for all images in the returned data to preload"),wpAjax.populateContent(_content,function(e){log("processRequest: Populated the content element with content, about to preload iamges"),e.waitForImages(function(){log("processRequest: All images in AJAX loaded content have preloaded"),$body.attr("class",data.match(/body class=\"(.*?)\"/)[1]),$(document).trigger(completeEvent),$(document).trigger(pageLoadEvent)})})):wpAjax.populateContent(_content,function(){log("processRequest: Requested AJAX content has been added to the content element and classes changed"),$body.attr("class",data.match(/body class=\"(.*?)\"/)[1]),$(document).trigger(completeEvent),$(document).trigger(pageLoadEvent)})):wpAjax.populateContent(_content,function(){log("processRequest: Requested AJAX content has been added to the content element and classes changed"),$("body").attr("class",data.match(/body class=\"(.*?)\"/)[1]),$(document).trigger(completeEvent),$(document).trigger(pageLoadEvent)}),wpAjax.fadeInContent()}else log("processRequest: Returned AJAX content is empty. Could be a problem server-side.")},wpAjax.populateContent=function(e,t){log("populateContent: About to populate the content element with returned HTML"),$content.html(e),$.isFunction(t)&&(log("populateContent: We've added in the content, calling the callback function with the element as an argument"),t($content))},window.wpAjax=wpAjax}(jQuery,window,window.document,window.History),function(){jQuery.expr[":"].regex=function(e,t,n){var o=n[3].split(","),a=/^(data|css):/,r={method:o[0].match(a)?o[0].split(":")[0]:"attr",property:o.shift().replace(a,"")},s="ig",c=new RegExp(o.join("").replace(/^\s+|\s+$/g,""),s);return c.test(jQuery(e)[r.method](r.property))}}(jQuery),function(e){e.ajaxPrefilter(function(e,t,n){function o(){var e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(t){return!1}}if(o()&&e.localCache){var a=e.cacheTTL||5,r=e.cacheKey||e.url.replace(/jQuery.*/,"")+e.type+(e.data||"");e.isCacheValid&&!e.isCacheValid()&&localStorage.removeItem(r);var s=localStorage.getItem(r+"cachettl");s&&s<+new Date&&(localStorage.removeItem(r),localStorage.removeItem(r+"cachettl"),s="expired");var c=localStorage.getItem(r);c?(0===e.dataType.indexOf("json")&&(c=JSON.parse(c)),e.success(c),n.abort()):(e.success&&(e.realsuccess=e.success),e.success=function(t){var n=t;0===this.dataType.indexOf("json")&&(n=JSON.stringify(t));try{localStorage.setItem(r,n)}catch(o){localStorage.removeItem(r),localStorage.removeItem(r+"cachettl"),e.cacheError&&e.cacheError(o,r,n)}e.realsuccess&&e.realsuccess(t)},s&&"expired"!==s||localStorage.setItem(r+"cachettl",+new Date+36e5*a))}})}(jQuery);